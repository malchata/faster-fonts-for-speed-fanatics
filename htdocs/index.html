<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Faster Fonts for Speed Fanatics</title><link rel="stylesheet" href="css/reveal.css"><link rel="stylesheet" href="css/theme/speed.css"><link rel="stylesheet" href="lib/css/zenburn.css"></head><body><div class="reveal"><div class="slides"><section><section data-state="title-card"><img class="stretch" src="/img/title-card.svg" alt="Faster Fonts for Speed Fanatics"></section></section><section><section data-state="section-slide"><h2>How browsers</h2><h2 class="accent">render fonts</h2></section><section><h2>Fonts load differently than</h2><h2 class="accent">other resources do</h2></section><section data-state="blackboard centered"><h2>A quick recap of</h2><h2>resource loading</h2></section><section data-state="blackboard centered"><h2 class="accent">meet the crew</h2></section><section data-state="blackboard centered"><img src="/img/server.svg" alt="A cartoony drawing of a web server."><h3 class="accent">server</h3></section><section data-state="blackboard centered"><img src="/img/browser.svg" alt="A cartoony drawing of a browser."><h3 class="accent">browser</h3></section><section data-state="blackboard centered"><img src="/img/resource.svg" alt="A cartoony drawing of a page resource."><h3 class="accent">resource</h3></section><section data-state="blackboard centered"><h2 class="accent">witness the action</h2></section><section data-state="blackboard centered"><img src="/img/request.svg" alt="A cartoony drawing of a browser requesting a resource."><h3 class="accent">request</h3></section><section data-state="blackboard centered"><img src="/img/response.svg" alt="A cartoony drawing of a web server sending a response."><h3 class="accent">response</h3></section><section data-state="blackboard centered"><h3 class="accent">render blocking in progress</h3></section><section data-state="blackboard centered"><img src="/img/paint.svg" alt="A cartoony drawing of a browser holding up a paint brush."><h3 class="accent">render</h3></section><section><h2>Render blocking is</h2><h2 class="accent">all about priorities</h2></section><section><h2>When it comes to fonts</h2><h2 class="accent">browsers speculate</h2></section><section data-state="blackboard centered"><h3 class="accent">The font loading process</h3><img class="stretch diagram" src="/img/font-loading.svg" alt="A rather complex diagram of how font loading works."></section><section><h2>Font loading in pictures:</h2><picture><source srcset="/img/font-loading-01.webp" type="image/webp"><img src="/img/font-loading-01.jpg" alt="A web browser loading fonts on a page, with no text visible yet."></picture><h3>1.89 s</h3></section><section><h2>Font loading in pictures:</h2><picture><source srcset="/img/font-loading-02.webp" type="image/webp"><img src="/img/font-loading-02.jpg" alt="A web browser loading fonts on a page, with only heading text visible (but not body copy)."></picture><h3>2.31 s</h3></section><section><h2>Font loading in pictures:</h2><picture><source srcset="/img/font-loading-03.webp" type="image/webp"><img src="/img/font-loading-03.jpg" alt="A web browser after loading all fonts on a page, with all text now visible."></picture><h3>2.42 s</h3></section></section><section><section data-state="section-slide"><h2>Host fonts on</h2><h2 class="accent">your own server</h2></section><section data-state="raccoon centered"><video muted id="raccoon"><source src="/video/raccoon.webm" type="video/webm"><source src="/video/raccoon.mp4" type="video/mp4"><source src="/video/raccoon.ogv" type="video/ogg"></video></section><section><h2>Host your own fonts</h2><h2 class="accent">for performance</h2></section><section><h2>Less hosts means</h2><h2 class="accent">less latency</h2></section><section><h3>Cross-origin font requests:</h3><picture><source srcset="/img/cross-origin-fonts.webp" type="image/webp"><img class="stretch" src="/img/cross-origin-fonts.png" alt="A waterfall chart in Chrome dev tools showing the latency involved with cross-origin font requests."></picture></section><section><h3>Same-origin font requests:</h3><picture><source srcset="/img/same-origin-fonts.webp" type="image/webp"><img class="stretch" src="/img/same-origin-fonts.png" alt="A waterfall chart in Chrome dev tools showing reducing latency with same origin font requests."></picture></section><section><h3>Can't host your own fonts?</h3><h2>Try <code>rel=preconnect</code></h2></section><section><div><h3>In the HTML <code>&lt;head&gt;</code> element</h3><pre><code class="html">&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com/&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com/&quot; crossorigin=&quot;anonymous&quot;&gt;</code></pre></div><div class="fragment"><h3>As an HTTP <code>Link</code> response header</h3><pre><code class="http">Link: &lt;https://fonts.googleapis.com/&gt;; rel=preconnect; crossorigin=anonymous, &lt;https://fonts.gstatic.com/&gt;; rel=preconnect; crossorigin=anonymous</code></pre></div></section><section><h3><code>rel=preconnect</code> absent:</h3><picture><source srcset="/img/no-preconnect-2x.webp 2x, /img/no-preconnect-1x.webp" type="image/webp"><source srcset="/img/no-preconnect-2x.png 2x, /img/no-preconnect-1x.png" type="image/png"><img class="stretch" src="/img/no-preconnect-1x.png" alt="A browser trace showing increased latency for font requests without `rel=preconnect` in use."></picture></section><section><h3><code>rel=preconnect</code> present:</h3><picture><source srcset="/img/preconnect-2x.webp 2x, /img/preconnect-1x.webp" type="image/webp"><source srcset="/img/preconnect-2x.png 2x, /img/preconnect-1x.png" type="image/png"><img class="stretch" src="/img/preconnect-1x.png" alt="A browser trace showing decreased latency for font requests without `rel=preconnect` in use."></picture></section><section data-state="warning"><h2 class="pulsate">Friendly reminder:</h2><h3 class="accent"><code>crossorigin</code> is weird</h3></section><section><h3><code>rel=preconnect</code> support:</h3><picture><source srcset="/img/preconnect-support-2x.webp 2x, /img/preconnect-support-1x.webp" type="image/webp"><source srcset="/img/preconnect-support-2x.png 2x, /img/preconnect-support-1x.png" type="image/png"><img src="/img/preconnect-support-1x.png" alt="Browser suppport matrix for rel=preconnect on caniuse.com"></picture></section><section><h2>No <code>rel=preconnect</code> support?</h2><h2 class="accent">nothing bad happens</h2></section><section><div><h3>HTML <code>&lt;link&gt;</code> element</h3><pre><code class="html">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;https://fonts.googleapis.com/&quot;&gt;
&lt;link rel=&quot;dns-prefetch&quot; href=&quot;https://fonts.gstatic.com/&quot;&gt;</code></pre></div><div class="fragment"><h3>As an HTTP <code>Link</code> response header</h3><pre><code class="http">Link: &lt;https://fonts.googleapis.com/&gt;; rel=dns-prefetch, &lt;https://fonts.gstatic.com/&gt;; rel=dns-prefetch</code></pre></div></section><section><h3><code>rel=dns-prefetch</code> support:</h3><picture><source srcset="/img/dns-prefetch-support-2x.webp 2x, /img/dns-prefetch-support-1x.webp" type="image/webp"><source srcset="/img/dns-prefetch-support-2x.png 2x, /img/dns-prefetch-support-1x.png" type="image/png"><img src="/img/dns-prefetch-support-1x.png" alt="Browser suppport matrix for rel=dns-prefetch on caniuse.com"></picture></section><section><h2>Hosting your own fonts</h2><h2 class="accent">offers more control</h2></section><section><h3>What you retain control of when you host your own fonts:</h3><ul><li class="fragment">Use of anything within a <code>@font-face</code></li><li class="fragment"><code>unicode-range</code></li><li class="fragment"><code>font-display</code></li><li class="fragment">Subsetting</li><li class="fragment">Easier use of <code>rel=preload</code></li><li></li></ul></section><section data-state="warning"><h1 class="pulsate">WARNING</h1><h3>Mind the EULAs!</h3></section></section><section><section data-state="section-slide"><h2><code>font-display</code></h2><h2 class="accent">for rendering control</h2></section><section><blockquote cite="https://www.w3.org/TR/css-fonts-4/#font-display-desc">&ldquo;The <code>font-display</code> descriptor for <code>@font-face</code> determines how a font face is displayed, based on whether and when it is downloaded and ready to use.&rdquo;<br><cite>&mdash; <a href="https://www.w3.org/TR/css-fonts-4/" rel="noopener">CSS Fonts Module Level 4 Specification</a></cite></blockquote></section><section><h2 class="accent">In other words,</h2><h3><code>font-display</code> overrides default browser rendering strategies of custom type faces.</h3></section><section><h3>A quick <code>font-display</code> example:</h3><pre><code class="css">@font-face {
  font-family: "Economica";
  font-style: normal;
  font-weight: 400;
  src: url("../fonts/economica-regular.woff2") format("woff2"),
       url("../fonts/economica-regular.woff") format("woff"),
       url("../fonts/economica-regular.ttf") format("truetype");
  font-display: swap; /* &lt;-- One-liners FTW! */
}</code></pre></section><section><h2><code>font-display: auto;</code></h2><h3>Browser default behavior kicks in</h3></section><section><h2><code>font-display: swap;</code></h2><h3>The browser displays the first locally installed font in a <code>font-family</code> stack, then swaps in custom typeface after it loads</h3></section><section data-state="foit-vs-fout centered"><h2>FOIT versus FOUT</h2><div class="flex-item-container"><div><video muted loop id="foit"><source src="/video/foit.webm" type="video/webm"><source src="/video/foit.mp4" type="video/mp4"><source src="/video/foit.ogv" type="video/ogg"></video><h3>FOIT</h3></div><div><video muted loop id="fout"><source src="/video/fout.webm" type="video/webm"><source src="/video/fout.mp4" type="video/mp4"><source src="/video/fout.ogv" type="video/ogg"></video><h3>FOUT</h3></div></div></section><section><h1>Embrace the FOUT</h1><ul><li class="fragment">Text is never blocked from being read</li><li class="fragment">If fonts fail to download, text won't be blocked until the FOIT timeout</li><li class="fragment">First meaningful paint and Speed Index of a page can be boosted</li></ul></section><section><h3>First Meaningful Paint (FMP) and Speed Index improvements</h3><table><thead><tr><th><code>font-display:</code></th><th>FMP</th><th>Speed Index</th></tr></thead><tbody><tr><td><code>auto</code></td><td>3,126</td><td>2,509</td></tr><tr><td><code>swap</code></td><td>1,645</td><td>2,439</td></tr></tbody></table></section><section><h2>Considerations with <code>swap</code></h2><ul><li class="fragment">Don't use it for icon fonts (use <code>block</code> for those)</li><li class="fragment"><a href="https://www.sarasoueidan.com/blog/icon-fonts-to-svg/" rel="noopener">Don't use icon fonts</a></li><li class="fragment">Typeface swapping causes layout shifting</li><li class="fragment">Layout shifting causes reflows/repaints</li></ul></section><section data-state="font-style-matcher"><h2>Font style matcher</h2><video muted loop id="font-style-matcher"><source src="/video/font-style-matcher.webm" type="video/webm"><source src="/video/font-style-matcher.ogv" type="video/ogg"><source src="/video/font-style-matcher.mp4" type="video/mp4"></video><h3><a href="https://meowni.ca/font-style-matcher/" rel="noopener">meowni.ca/font-style-matcher</a></h3></section><section><h2><code>font-display: optional;</code></h2><h3>FOIT occurs for a very short time. On poor connections, the browser might skip loading the font, or download it in the background for the next page navigation</h3></section><section><h2>Learn more about<br><code>font-display</code> on the web</h2><picture><source srcset="/img/css-tricks-font-display-2x.webp 2x, /img/css-tricks-font-display-1x.webp" type="image/webp"><source srcset="/img/css-tricks-font-display-2x.png 2x, /img/css-tricks-font-display-1x.png" type="image/png"><img src="/img/css-tricks-font-display-1x.png" alt="Screenshot of CSS-Tricks `font-display` article in the browser."></picture><h3><a href="https://css-tricks.com/font-display-masses/" rel="noopener">css-tricks.com/font-display-masses</a></h3></section></section><section><section data-state="section-slide"><h2><code>rel=preload</code></h2><h2 class="accent">for faster font loading</h2></section><section><blockquote cite="https://www.w3.org/TR/preload/#early-fetch-of-critical-resources">&quot;...most resource declarations specified within JavaScript and CSS are 'hidden' from the speculative parsers and incur a performance penalty. To address this, the application can use a preload link to declaratively specify which resources the user agent must fetch early to improve page performance.&quot; <cite>&mdash; <a href="https://www.w3.org/TR/preload/#early-fetch-of-critical-resources" rel="noopener">Preload Specification, &sect; A.1</a></cite></blockquote></section><section><h2 class="accent">In other words,</h2><h3><code>rel=preload</code> initiates an early fetch for a resource before the browser knows it even needs it</h3></section><section><h1><code>rel=preload</code> boosts resource priority</h1><hr><div class="fragment"><h3>Without <code>rel=preload</code></h3><picture><source srcset="/img/low-asset-priority.webp" type="image/webp"><img src="/img/low-asset-priority.png" alt="A listing of a page resource in Chrome's network panel, showing a low priority."></picture></div><div class="fragment"><h3>With <code>rel=preload</code></h3><picture><source srcset="/img/high-asset-priority.webp" type="image/webp"><img src="/img/high-asset-priority.png" alt="A listing of a page resource in Chrome's network panel, now showing a high priority due to use of rel=preload to load the asset."></picture></div></section><section><h3><code>rel=preload</code> support:</h3><picture><source srcset="/img/preload-support-2x.webp 2x, /img/preload-support-1x.webp" type="image/webp"><source srcset="/img/preload-support-2x.png 2x, /img/preload-support-1x.png" type="image/png"><img src="/img/preload-support-1x.png" alt="Browser suppport matrix for rel=preload on caniuse.com"></picture></section><section><div><h3>HTML <code>&lt;link&gt;</code> element</h3><pre><code class="html">&lt;link rel=&quot;preload&quot; href=&quot;/css/styles.css&quot; rel=&quot;preload&quot; as=&quot;style&quot; type=&quot;text/css&quot;&gt;
  &lt;link rel=&quot;preload&quot; href=&quot;/css/fonts/firasans-regular.woff2&quot; rel=&quot;preload&quot; as=&quot;font&quot; type=&quot;font/woff2&quot; crossorigin&gt;</code></pre></div><div class="fragment"><h3>As an HTTP <code>Link</code> response header</h3><pre><code class="http">Link: &lt;/css/styles.css&gt;; rel=preload; as=style; type=text/css; nopush, &lt;/css/fonts/firasans-regular.woff2&gt;; rel=preload; as=font; type=font/woff2; crossorigin=anonymous; nopush,</code></pre></div></section><section><h3>Critical request chain without<br>font preloading:</h3><picture><source srcset="/img/crp-no-preload-2x.webp 2x, /img/crp-no-preload-1x.webp" type="image/webp"><source srcset="/img/crp-no-preload-2x.png 2x, /img/crp-no-preload-1x.png" type="image/png"><img class="stretch" src="/img/crp-no-preload-1x.png" alt="A suboptimal critical request chain as audited by Lighthouse."></picture></section><section><h3>Critical request chain with<br>font preloading:</h3><picture><source srcset="/img/crp-preload-2x.webp 2x, /img/crp-preload-1x.webp" type="image/webp"><source srcset="/img/crp-preload-2x.png 2x, /img/crp-preload-1x.png" type="image/png"><img class="stretch" src="/img/crp-preload-1x.png" alt="An optimized critical request chain as audited by Lighthouse."></picture></section><section><h3>Unassisted font retrieval:</h3><picture><source srcset="/img/waterfall-no-preload-2x.webp 2x, /img/waterfall-no-preload-1x.webp" type="image/webp"><source srcset="/img/waterfall-no-preload-2x.png 2x, /img/waterfall-no-preload-1x.png" type="image/png"><img class="stretch" src="/img/waterfall-no-preload-1x.png" alt="A resource waterfall graph of a page with fonts downloaded in their natural order."></picture></section><section><h3>Reprioritizing with <code>rel=preload</code>:</h3><picture><source srcset="/img/waterfall-preload-2x.webp 2x, /img/waterfall-preload-1x.webp" type="image/webp"><source srcset="/img/waterfall-preload-2x.png 2x, /img/waterfall-preload-1x.png" type="image/png"><img class="stretch" src="/img/waterfall-preload-1x.png" alt="A resource waterfall graph of a page with fonts effectively reprioritized using `rel=preload`."></picture></section></section><section><section data-state="section-slide"><h2>Use <code>Save-Data</code> to</h2><h2 class="accent">skip unnecessary fonts</h2></section><section><blockquote cite="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints-05#section-3.4">&quot;The <code>Save-Data</code> request header field consists of one or more tokens that indicate client's preference for reduced data usage, due to high transfer costs, slow connection speeds, or other reasons.&quot; <cite>&mdash; <a href="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints-05#section-3.4" rel="noopener">HTTP Client Hints Specification, &sect; 3.4</a></cite></blockquote></section><section><h2 class="accent">In other words,</h2><h3><code>Save-Data</code> is a request header sent when a "Data Saver" mode is enabled. Applications can detect this header and modify front end code to deliver lighter user experiences.</h3></section><section><h2>How <code>Save-Data</code> works</h2><picture><source srcset="/img/data-saver-android-2x.webp 2x, /img/data-saver-android-1x.webp" type="image/webp"><source srcset="/img/data-saver-android-2x.png 2x, /img/data-saver-android-1x.png" type="image/png"><img src="/img/data-saver-android-1x.png" alt="A settings screen in Chrome where a user can toggle the data saver mode, along with a readout of bytes saved."></picture><h3>toggle data saver (Chrome for Android)</h3></section><section><h2>How <code>Save-Data</code> works</h2><picture><source srcset="/img/save-data-header-2x.webp 2x, /img/save-data-header-1x.webp" type="image/webp"><source srcset="/img/save-data-header-2x.png 2x, /img/save-data-header-1x.png" type="image/png"><img class="stretch larger" src="/img/save-data-header-1x.png" alt="Request headers for an asset shown in Chrome dev tools, with the `Save-Data` header at the bottom of the list."></picture><h3>browser sends a <code>Save-Data</code> header with a value of <code>On</code> with every request</h3></section><section><h1><code>Save-Data</code> use cases:</h1><ul><li class="fragment">Serve low resolution imagery for high-res screens</li><li class="fragment">Stream lower quality video</li><li class="fragment">Opt out of server pushes</li><li class="fragment">Opt out of non-essential media</li><li class="fragment">Opt out of &quot;nice-to-have&quot; typefaces</li></ul></section><section><h1>Detect <code>Save-Data</code></h1><pre><code class="php">&lt;?php
$saveData = false;

if(isset($_SERVER["HTTP_SAVE_DATA"]) && strtolower($_SERVER["HTTP_SAVE_DATA"]) === "on"){
  $saveData = true;
}
?&gt;</code></pre></section><section><h2>Conditionally serve <code>@font-faces</code></h2><pre><code class="html">&lt;!-- We needs it --&gt;
&lt;style&gt;
  @font-face{
    font-family: "Sooo Important Sans";
    src: local("Sooo Important Sans"),
         url("/fonts/sooo-important.woff2") format("woff2"),
         url("/fonts/sooo-important.woff") format("woff"),
         url("/fonts/sooo-important.ttf") format("truetype");
  }
&lt;/style&gt;

&lt;!-- Nice to have, but not a deal-breaker --&gt;
&lt;?php if($saveData === false){ ?&gt;
  &lt;style&gt;
    @font-face{
      font-family: "Whatever Sans";
      src: local("Whatever Sans"),
           url("/fonts/whatever.woff2") format("woff2"),
           url("/fonts/whatever.woff") format("woff"),
           url("/fonts/whatever.ttf") format("truetype");
    }
  &lt;/style&gt;
&lt;?php } ?&gt;</code></pre><h3>(Method 1)</h3></section><section><h2>Conditionally serve <code>@font-faces</code></h2><h3>(Method 2)</h3></section><section><h1><code>Save-Data</code> kicks in</h1><hr><div class="flex-item-container"><div class="fragment"><h3>Without</h3><picture><source srcset="/img/save-data-off-2x.webp 2x, /img/save-data-off-1x.webp" type="image/webp"><source srcset="/img/save-data-off-2x.png 2x, /img/save-data-off-1x.png" type="image/png"><img class="full" src="/img/save-data-off-1x.png" alt="A list of font resources in Chrome's network panel, showing all fonts downloaded when `Save-Data` is off."></picture></div><div class="fragment"><h3>With</h3><picture><source srcset="/img/save-data-on-2x.webp 2x, /img/save-data-on-1x.webp" type="image/webp"><source srcset="/img/save-data-on-2x.png 2x, /img/save-data-on-1x.png" type="image/png"><img class="full" src="/img/save-data-on-1x.png" alt="A list of font resources in Chrome's network panel, showing only a few fonts downloaded because `Save-Data` is on."></picture></div></div></section><section><h1>Typeface differences</h1><hr><div class="flex-item-container"><div><h3>Without <code>Save-Data</code></h3><picture><source srcset="/img/more-typefaces-2x.webp 2x, /img/more-typefaces-1x.webp" type="image/webp"><source srcset="/img/more-typefaces-2x.png 2x, /img/more-typefaces-1x.png" type="image/png"><img class="full" src="/img/more-typefaces-1x.png" alt="A page rendering with the body copy in a custom typeface."></picture></div><div><h3>With <code>Save-Data</code></h3><picture><source srcset="/img/less-typefaces-2x.webp 2x, /img/less-typefaces-1x.webp" type="image/webp"><source srcset="/img/less-typefaces-2x.png 2x, /img/less-typefaces-1x.png" type="image/png"><img class="full" src="/img/less-typefaces-1x.png" alt="A page rendering with the body copy in a system typeface because `Save-Data` is on."></picture></div></div></section><section><h2>Learn more about<br><code>Save-Data</code> on the web</h2><picture><source srcset="/img/css-tricks-save-data-2x.webp 2x, /img/css-tricks-save-data-1x.webp" type="image/webp"><source srcset="/img/css-tricks-save-data-2x.png 2x, /img/css-tricks-save-data-1x.png" type="image/png"><img src="/img/css-tricks-save-data-1x.png" alt="Screenshot of CSS-Tricks `Save-Data` article in the browser."></picture><h3><a href="https://css-tricks.com/help-users-save-data/" rel="noopener">css-tricks.com/help-users-save-data</a></h3></section></section><section><section data-state="wrap-it-up"><video muted id="wrap-it-up"><source src="/video/wrap-it-up.webm" type="video/webm"><source src="/video/wrap-it-up.mp4" type="video/mp4"><source src="/video/wrap-it-up.ogv" type="video/ogg"></video></section></section></div></div><script src="lib/js/head.min.js"></script><script src="js/reveal.js"></script><script>Reveal.initialize({history:!0,controls:!1,transition:"none",progress:!1,viewDistance:2,help:!1,dependencies:[{src:"plugin/notes/notes.js",async:!0},{src:"plugin/highlight/highlight.js",async:!0,callback:function(){hljs.initHighlightingOnLoad()}}]}),Reveal.addEventListener("raccoon",function(){document.getElementById("raccoon").play()}),Reveal.addEventListener("font-style-matcher",function(){document.getElementById("font-style-matcher").play()}),Reveal.addEventListener("foit-vs-fout",function(){document.getElementById("foit").play(),document.getElementById("fout").play()}),Reveal.addEventListener("wrap-it-up",function(){document.getElementById("wrap-it-up").play()})</script><script src="/js/jquery.js"></script></body></html>