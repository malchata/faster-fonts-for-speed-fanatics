<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Faster Fonts for Speed Fanatics</title>
    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/speed.css">
    <link rel="stylesheet" href="lib/css/zenburn.css">
  </head>
  <body>
    <!--
      [0.0] - Intro
      [1.0] - How Browsers Render Fonts
      [2.0] - Host fonts on your server
      [3.0] - `font-display`
      [4.0] - `rel=preload`
      [5.0] - `Save-Data`
    -->
    <div class="reveal">
      <div class="slides">
        <!-- [0.0] - Intro -->
        <section>
          <!-- [0.1] - Title Card -->
          <section data-state="title-card">
          </section>
        </section>
        <!-- [1.0] - How Browsers Render Fonts -->
        <section>
          <!-- [1.1] - How Browsers Render Fonts -->
          <section data-state="section-slide">
            <div class="unfocused-heading invisible">
              <h4>&nbsp;</h4>
              <h4 class="accent">&nbsp;</h4>
            </div>
            <div class="focused-heading">
              <h2>How browsers</h2>
              <h2 class="accent">render fonts</h2>
            </div>
            <div class="unfocused-heading">
              <h4>Host your own fonts</h4>
              <h4 class="accent">for performance</h4>
            </div>
          </section>
          <!-- [1.2] - The truth about font rendering -->
          <section class="statement-slide">
            <h2>Fonts load differently than</h2>
            <h2 class="accent">other resources do</h2>
          </section>
          <!-- [1.3] - A story about resource loading -->
          <section data-state="blackboard centered">
            <h2>A quick recap of</h2>
            <h2 class="accent">resource loading</h2>
          </section>
          <!-- [1.4] - Meet the crew -->
          <section data-state="blackboard centered">
            <h2 class="accent">meet the crew</h2>
          </section>
          <!-- [1.5] - Web server -->
          <section data-state="blackboard centered">
            <img src="/img/server.svg" alt="A cartoony drawing of a web server.">
            <h3 class="accent">server</h3>
          </section>
          <!-- [1.6] - Browser -->
          <section data-state="blackboard centered">
            <img src="/img/browser.svg" alt="A cartoony drawing of a browser.">
            <h3 class="accent">browser</h3>
          </section>
          <!-- [1.7] - Resource -->
          <section data-state="blackboard centered">
            <img src="/img/resource.svg" alt="A cartoony drawing of a page resource.">
            <h3 class="accent">resource</h3>
          </section>
          <!-- [1.8] - Witness the action -->
          <section data-state="blackboard centered">
            <h2 class="accent">witness the action</h2>
          </section>
          <!-- [1.9] - The browser requests a resource -->
          <section data-state="blackboard centered">
            <img src="/img/request.svg" alt="A cartoony drawing of a browser requesting a resource.">
            <h3 class="accent">request</h3>
          </section>
          <!-- [1.10] - Server responds -->
          <section data-state="blackboard centered">
            <img src="/img/response.svg" alt="A cartoony drawing of a web server sending a response.">
            <h3 class="accent">response</h3>
          </section>
          <!-- [1.11] - Intermission -->
          <section data-state="blackboard centered">
            <h2>render blocking</h2>
            <h3 class="accent">in progress</h3>
          </section>
          <!-- [1.12] - The page begins painting -->
          <section data-state="blackboard centered">
              <img src="/img/paint.svg" alt="A cartoony drawing of a browser holding up a paint brush.">
              <h3 class="accent">render</h3>
          </section>
          <!-- [1.13] - Rendering block is a matter of priorities -->
          <section class="statement-slide">
            <h2>Render blocking is</h2>
            <h2 class="accent">all about priorities</h2>
          </section>
          <!-- [1.14] - Browser speculate about fonts -->
          <section class="statement-slide">
            <h2>When it comes to fonts</h2>
            <h2 class="accent">browsers speculate</h2>
          </section>
          <!-- [1.15] - The font loading process -->
          <section data-state="blackboard centered">
            <h3 class="accent">The font loading process</h3>
            <img class="stretch diagram" src="/img/font-loading.svg" alt="A rather complex diagram of how font loading works.">
          </section>
          <!-- [1.16] - Font loading in pictures (Pt. I) -->
          <section>
            <h2>Font loading in pictures:</h2>
            <picture>
              <source srcset="/img/font-loading-01.webp" type="image/webp">
              <img src="/img/font-loading-01.jpg" alt="A web browser loading fonts on a page, with no text visible yet.">
            </picture>
            <h3>1.89 s</h3>
          </section>
          <!-- [1.17] - Font loading in pictures (Pt. II) -->
          <section>
            <h2>Font loading in pictures:</h2>
            <picture>
              <source srcset="/img/font-loading-02.webp" type="image/webp">
              <img src="/img/font-loading-02.jpg" alt="A web browser loading fonts on a page, with only heading text visible (but not body copy).">
            </picture>
            <h3>2.31 s</h3>
          </section>
          <!-- [1.18] - Font loading in pictures (Pt. III) -->
          <section>
            <h2>Font loading in pictures:</h2>
            <picture>
              <source srcset="/img/font-loading-03.webp" type="image/webp">
              <img src="/img/font-loading-03.jpg" alt="A web browser after loading all fonts on a page, with all text now visible.">
            </picture>
            <h3>2.42 s</h3>
          </section>
          <!-- [1.19] - Web fonts are ripe for fine-tuning -->
          <section class="statement-slide">
            <h2>Web fonts are ripe for</h2>
            <h2 class="accent">performance tuning</h2>
          </section>
        </section>
        <!-- [2.0] - Hosting your own fonts-->
        <section>
          <!-- [2.1] - Hosting your own fonts -->
          <section data-state="section-slide">
            <div class="unfocused-heading">
              <h4>How browsers</h4>
              <h4 class="accent">render fonts</h4>
            </div>
            <div class="focused-heading">
              <h2>Host fonts on</h2>
              <h2 class="accent">your own server</h2>
            </div>
            <div class="unfocused-heading">
              <h4><code>font-display</code></h4>
              <h4 class="accent">for rendering control</h4>
            </div>
          </section>
          <!-- [2.2] - What we usually do -->
          <section data-state="raccoon centered">
            <video muted id="raccoon">
              <source src="/video/raccoon.webm" type="video/webm">
              <source src="/video/raccoon.mp4" type="video/mp4">
              <source src="/video/raccoon.ogv" type="video/ogg">
            </video>
          </section>
          <!-- [2.3] - Hosting your own fonts can offer better performance -->
          <section class="statement-slide">
              <h2>Host your own fonts</h2>
              <h2 class="accent">for performance</h2>
          </section>
          <!-- [2.4] - Less cross-origin requests can mean less latency -->
          <section class="statement-slide">
            <h2>Less hosts means</h2>
            <h2 class="accent">less latency</h2>
          </section>
          <!-- [2.5] - Cross-origin font requests -->
          <section>
            <h2>Cross-origin fonts:</h2>
            <picture>
              <source srcset="/img/cross-origin-fonts.webp" type="image/webp">
              <img class="stretch" src="/img/cross-origin-fonts.png" alt="A waterfall chart in Chrome dev tools showing the latency involved with cross-origin font requests.">
            </picture>
            <h3>Speed Index: 3,798</h3>
            <h6>(WebPagetest, Slow 3G, Dulles, VA, Motorola G (Gen4)</h6>
          </section>
          <!-- [2.6] - Same-origin font requests -->
          <section>
            <h2>Same-origin fonts:</h2>
            <picture>
              <source srcset="/img/same-origin-fonts.webp" type="image/webp">
              <img class="stretch" src="/img/same-origin-fonts.png" alt="A waterfall chart in Chrome dev tools showing reducing latency with same origin font requests.">
            </picture>
            <h3>Speed Index: 2,474 <span class="fragment">(~35% improvement)</span></h3>
            <h6>(WebPagetest, Slow 3G, Dulles, VA, Motorola G (Gen4)</h6>
          </section>
          <!-- [2.7] - If you can't host your own fonts, use `rel=preconnect` -->
          <section class="statement-slide">
            <h2>try <code>rel=preconnect</code> when hosting your own fonts</h2>
            <h2 class="accent">just isn't doable</h2>
          </section>
          <!-- [2.8] - Using `rel=preconnect` -->
          <section>
            <div>
              <h3>In HTML:</h3>
              <pre><code class="html">&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.googleapis.com/&quot; crossorigin=&quot;anonymous&quot;&gt;
&lt;link rel=&quot;preconnect&quot; href=&quot;https://fonts.gstatic.com/&quot; crossorigin=&quot;anonymous&quot;&gt;</code></pre>
            </div>
            <div class="fragment">
              <h3>As an HTTP response header:</h3>
              <pre><code class="http">Link: &lt;https://fonts.googleapis.com/&gt;; rel=preconnect; crossorigin=anonymous, &lt;https://fonts.gstatic.com/&gt;; rel=preconnect; crossorigin=anonymous</code></pre>
            </div>
          </section>
          <!-- [2.9] - Without `rel=preconnect` -->
          <section>
            <h2>Without <code>rel=preconnect</code>:</h2>
            <picture>
              <source srcset="/img/no-preconnect.webp" type="image/webp">
              <img src="/img/no-preconnect.png" alt="A browser trace showing increased latency for font requests without `rel=preconnect` in use.">
            </picture>
            <h3>Speed Index: 3,877</h3>
            <h6>(WebPagetest, Slow 3G, Dulles, VA, Motorola G (Gen4)</h6>
          </section>
          <!-- [2.10] - With `rel=preconnect` -->
          <section>
            <h2>With <code>rel=preconnect</code>:</h2>
            <picture>
              <source srcset="/img/preconnect.webp" type="image/webp">
              <img src="/img/preconnect.png" alt="A browser trace showing decreased latency for font requests without `rel=preconnect` in use.">
            </picture>
            <h3>Speed Index: 3,619 <span class="fragment">(~7% improvement)</span></h3>
            <h6>(WebPagetest, Slow 3G, Dulles, VA, Motorola G (Gen4)</h6>
          </section>
          <!-- [2.11] - Friendly reminder: `crossorigin` is weird -->
          <section data-state="warning">
            <h2 class="accent">Friendly reminder:</h2>
            <h3>Don't forget about the <code>crossorigin</code> attribute!</h3>
          </section>
          <!-- [2.12] - `rel=preconnect` Support -->
          <section>
            <h3><code>rel=preconnect</code> support:</h3>
            <picture>
              <source srcset="/img/preconnect-support-2x.webp 2x, /img/preconnect-support-1x.webp 1x" type="image/webp">
              <source srcset="/img/preconnect-support-2x.png 2x, /img/preconnect-support-1x.png 1x" type="image/png">
              <img src="/img/preconnect-support-1x.png" alt="Browser suppport matrix for rel=preconnect on caniuse.com">
            </picture>
          </section>
          <!-- [2.13] - Nothing bad will happen -->
          <section class="statement-slide">
            <h2>
              Browser doesn't support<br>
              <code>rel=preconnect</code>?
            </h2>
            <h2 class="accent fragment">nothing bad will happen <span class="fragment">(promise)</span></h2>
          </section>
          <!-- [2.14] - `rel=dns-prefetch` is also an option -->
          <section class="statement-slide">
            <h2><code>rel=dns-prefetch</code></h2>
            <h2 class="accent">is also an option</h2>
          </section>
          <!-- [2.15] - `rel=dns-prefetch` is an option, too! -->
          <section>
            <div>
              <h3>In HTML:</h3>
              <pre><code class="html">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;https://fonts.googleapis.com/&quot;&gt;
&lt;link rel=&quot;dns-prefetch&quot; href=&quot;https://fonts.gstatic.com/&quot;&gt;</code></pre>
            </div>
            <div class="fragment">
              <h3>As an HTTP response header:</h3>
              <pre><code class="http">Link: &lt;https://fonts.googleapis.com/&gt;; rel=dns-prefetch, &lt;https://fonts.gstatic.com/&gt;; rel=dns-prefetch</code></pre>
            </div>
          </section>
          <!-- [2.16] - `rel=dns-prefetch` Support -->
          <section>
            <h3><code>rel=dns-prefetch</code> support:</h3>
            <picture>
              <source srcset="/img/dns-prefetch-support-2x.webp 2x, /img/dns-prefetch-support-1x.webp 1x" type="image/webp">
              <source srcset="/img/dns-prefetch-support-2x.png 2x, /img/dns-prefetch-support-1x.png 1x" type="image/png">
              <img src="/img/dns-prefetch-support-1x.png" alt="Browser suppport matrix for rel=dns-prefetch on caniuse.com">
            </picture>
          </section>
          <!-- [2.17] - Hosting your own fonts offers more control -->
          <section class="statement-slide">
              <h2>Hosting your own fonts</h2>
              <h2 class="accent">offers more control</h2>
          </section>
          <!-- [2.18] - What you retain control of when you host your own fonts -->
          <section>
            <h2>What you retain control of:</h2>
            <ul>
              <li class="fragment">Use of anything within a <code>@font-face</code></li>
              <li class="fragment"><code>unicode-range</code></li>
              <li class="fragment"><code>font-display</code></li>
              <li class="fragment">Subsetting</li>
              <li class="fragment">Easier use of <code>rel=preload</code></li>
            </ul>
          </section>
          <!-- [2.19] - Friendly reminder: Mind licensing agreements -->
          <section data-state="warning">
            <h2 class="accent">Friendly reminder:</h2>
            <h3>mind the licensing agreements!</h3>
          </section>
        </section>
        <!-- [3.0] - `font-display` -->
        <section>
          <!-- [3.1] - `font-display` for easy control over font rendering -->
          <section data-state="section-slide">
            <div class="unfocused-heading">
              <h4>Host fonts on</h4>
              <h4 class="accent">your own server</h4>
            </div>
            <div class="focused-heading">
              <h2><code>font-display</code></h2>
              <h2 class="accent">for rendering control</h2>
            </div>
            <div class="unfocused-heading">
              <h4><code>rel=preload</code></h4>
              <h4 class="accent">for faster font loading</h4>
            </div>
          </section>
          <!-- [3.2] - What does `font-display` do? -->
          <section>
            <blockquote cite="https://www.w3.org/TR/css-fonts-4/#font-display-desc">
              &ldquo;The <code>font-display</code> descriptor for <code>@font-face</code> determines how a font face is displayed, based on whether and when it is downloaded and ready to use.&rdquo;<br>
              <cite>&mdash; <a href="https://www.w3.org/TR/css-fonts-4/" rel="noopener">CSS Fonts Module Level 4 Specification</a></cite>
            </blockquote>
          </section>
          <!-- [3.3] - `font-display` overrides default browser rendering strategies of custom type faces -->
          <section class="statement-slide">
            <h2 class="accent">In other words,</h2>
            <h3><code>font-display</code> overrides default browser rendering strategies of custom type faces</h3>
          </section>
          <!-- [3.4] - Quick `font-display` example -->
          <section>
            <h3>A quick example:</h3>
            <pre><code class="css">@font-face {
  font-family: "Economica";
  font-style: normal;
  font-weight: 400;
  src: url("../fonts/economica-regular.woff2") format("woff2"),
       url("../fonts/economica-regular.woff") format("woff"),
       url("../fonts/economica-regular.ttf") format("truetype");
  font-display: swap; /* &lt;-- T h e  g o o d  s t u f f */
}</code></pre>
          </section>
          <!-- [3.5] - `font-display: auto` -->
          <section>
            <h3><code>font-display: auto;</code></h3>
            <h3>Browser default behavior kicks in</h3>
          </section>
          <!-- [3.6] - `font-display: swap` -->
          <section>
            <h3><code>font-display: swap;</code></h3>
            <h3>The browser displays the first locally installed font in a <code>font-family</code> stack<span class="fragment">, then swaps in custom typeface after it loads</span></h3>
          </section>
          <!-- [3.7] - FOIT vs. FOUT -->
          <section data-state="foit-vs-fout centered">
            <h2>FOIT <span class="accent">versus</span> FOUT</h2>
            <div class="flex-item-container">
              <div>
                <video muted loop id="foit">
                  <source src="/video/foit.webm" type="video/webm">
                  <source src="/video/foit.mp4" type="video/mp4">
                  <source src="/video/foit.ogv" type="video/ogg">
                </video>
                <h3>FOIT</h3>
              </div>
              <div>
                <video muted loop id="fout">
                  <source src="/video/fout.webm" type="video/webm">
                  <source src="/video/fout.mp4" type="video/mp4">
                  <source src="/video/fout.ogv" type="video/ogg">
                </video>
                <h3>FOUT</h3>
              </div>
            </div>
          </section>
          <!-- [3.8] - Embrace the FOUT -->
          <section>
            <h2>Embrace the FOUT</h2>
            <ul>
              <li class="fragment">Text is never blocked from being read</li>
              <li class="fragment">If fonts fail to download, text won't be blocked until the FOIT timeout</li>
              <li class="fragment">First meaningful paint and speed index metrics of a page can be boosted</li>
            </ul>
          </section>
          <!-- [3.9] Improvement stats -->
          <section>
            <h3>First Meaningful Paint (FMP) and Speed Index improvements</h3>
            <table>
              <thead>
                <tr>
                  <th><code>font-display:</code></th>
                  <th>FMP</th>
                  <th>Speed Index</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><code>auto</code></td>
                  <td>3,126</td>
                  <td>2,509</td>
                </tr>
                <tr>
                  <td><code>swap</code></td>
                  <td>1,645</td>
                  <td>2,439</td>
                </tr>
              </tbody>
            </table>
          </section>
          <!-- [3.10] - Considerations with `swap` -->
          <section>
            <h2>Considerations with <code>swap</code></h2>
            <ul>
              <li class="fragment">Don't use it for icon fonts (use <code>block</code> for those)</li>
              <li class="fragment"><a href="https://www.sarasoueidan.com/blog/icon-fonts-to-svg/" rel="noopener">Don't use icon fonts</a> <span class="fragment">(if that's cool, I mean)</span></li>
              <li class="fragment">Typeface swapping causes layout shifting</li>
              <li class="fragment">Layout shifting causes reflows/repaints</li>
            </ul>
          </section>
          <!-- [3.11] - Font style matcher -->
          <section data-state="font-style-matcher centered">
            <video muted loop id="font-style-matcher">
              <source src="/video/font-style-matcher.webm" type="video/webm">
              <source src="/video/font-style-matcher.ogv" type="video/ogg">
              <source src="/video/font-style-matcher.mp4" type="video/mp4">
            </video>
            <h3><a href="https://meowni.ca/font-style-matcher/" rel="noopener">meowni.ca/font-style-matcher</a></h3>
          </section>
          <!-- [3.12] - `font-display: optional` -->
          <section>
            <h3><code>font-display: optional;</code></h3>
            <h3>FOIT occurs for a very short time. On bad connections, the browser skips loading the font, or downloads it in the background</h3>
          </section>
          <!-- [3.13] - Learn more about `font-display` on the web -->
          <section>
            <h2>
              Learn more about<br>
              <code>font-display</code> on the web:
            </h2>
            <picture>
              <source srcset="/img/css-tricks-font-display-2x.webp 2x, /img/css-tricks-font-display-1x.webp 1x" type="image/webp">
              <source srcset="/img/css-tricks-font-display-2x.png 2x, /img/css-tricks-font-display-1x.png 1x" type="image/png">
              <img src="/img/css-tricks-font-display-1x.png" alt="Screenshot of CSS-Tricks `font-display` article in the browser.">
            </picture>
            <h3><a href="https://css-tricks.com/font-display-masses/" rel="noopener">css-tricks.com/font-display-masses</a></h3>
          </section>
        </section>
        <!-- [4.0] - `rel=preload` -->
        <section>
          <!-- [4.1] - Accelerate font rendering with `rel=preload` -->
          <section data-state="section-slide">
            <div class="unfocused-heading">
              <h4><code>font-display</code></h4>
              <h4 class="accent">for rendering control</h4>
            </div>
            <div class="focused-heading">
              <h2><code>rel=preload</code></h2>
              <h2 class="accent">for faster font loading</h2>
            </div>
            <div class="unfocused-heading">
              <h4><code>Save-Data</code> and</h4>
              <h4 class="accent">skip unnecessary fonts</h4>
            </div>
          </section>
          <!-- [4.2] - What is `rel=preload`? -->
          <section>
            <blockquote cite="https://www.w3.org/TR/preload/#early-fetch-of-critical-resources">
              &quot;...most resource declarations specified within JavaScript and CSS are 'hidden' from the speculative parsers and incur a performance penalty. To address this, the application can use a preload link to declaratively specify which resources the user agent must fetch early to improve page performance.&quot;
              <cite>&mdash; <a href="https://www.w3.org/TR/preload/#early-fetch-of-critical-resources" rel="noopener">Preload Specification, &sect; A.1</a></cite>
            </blockquote>
          </section>
          <!-- [4.3] - In other words -->
          <section class="statement-slide">
            <h2 class="accent">In other words,</h2>
            <h3><code>rel=preload</code> initiates an early fetch for a resource before the browser knows it even needs it</h3>
          </section>
          <!-- [4.4] - A change of priorities -->
          <section class="statement-slide">
            <h2><code>rel=preload</code></h2>
            <h2 class="accent">boosts priority</h2>
          </section>
          <!-- [4.5] - Reprioritized assets -->
          <section>
            <div>
              <h3>Without <code>rel=preload</code>:</h3>
              <picture>
                <source srcset="/img/low-asset-priority.webp" type="image/webp">
                <img src="/img/low-asset-priority.png" alt="A listing of a page resource in Chrome's network panel, showing a low priority.">
              </picture>
            </div>
            <div class="fragment">
              <h3>With <code>rel=preload</code>:</h3>
              <picture>
                <source srcset="/img/high-asset-priority.webp" type="image/webp">
                <img src="/img/high-asset-priority.png" alt="A listing of a page resource in Chrome's network panel, now showing a high priority due to use of rel=preload to load the asset.">
              </picture>
            </div>
          </section>
          <!-- [4.5] - `rel=preload` support -->
          <section>
            <h3><code>rel=preload</code> support:</h3>
            <picture>
              <source srcset="/img/preload-support-2x.webp 2x, /img/preload-support-1x.webp 1x" type="image/webp">
              <source srcset="/img/preload-support-2x.png 2x, /img/preload-support-1x.png 1x" type="image/png">
              <img src="/img/preload-support-1x.png" alt="Browser suppport matrix for rel=preload on caniuse.com">
            </picture>
          </section>
          <!-- [4.6] - Using `rel=preload` -->
          <section>
            <div>
              <h3>In HTML:</h3>
              <pre><code class="html">&lt;link rel=&quot;preload&quot; href=&quot;/css/styles.css&quot; rel=&quot;preload&quot; as=&quot;style&quot; type=&quot;text/css&quot;&gt;
&lt;link rel=&quot;preload&quot; href=&quot;/css/fonts/firasans-regular.woff2&quot; rel=&quot;preload&quot; as=&quot;font&quot; type=&quot;font/woff2&quot; crossorigin&gt;</code></pre>
            </div>
            <div class="fragment">
              <h3>As an HTTP response header:</h3>
              <pre><code class="http">Link: &lt;/css/styles.css&gt;; rel=preload; as=style; type=text/css; nopush, &lt;/css/fonts/firasans-regular.woff2&gt;; rel=preload; as=font; type=font/woff2; crossorigin=anonymous; nopush,</code></pre>
            </div>
          </section>
          <!-- [4.7] - Critical request chain without `rel=preload` -->
          <section>
            <h3>
                Critical request chain without<br>
                font preloading:
            </h3>
            <picture>
              <source srcset="/img/crp-no-preload-2x.webp 2x, /img/crp-no-preload-1x.webp 1x" type="image/webp">
              <source srcset="/img/crp-no-preload-2x.png 2x, /img/crp-no-preload-1x.png 1x" type="image/png">
              <img class="stretch" src="/img/crp-no-preload-1x.png" alt="A suboptimal critical request chain as audited by Lighthouse.">
            </picture>
          </section>
          <!-- [4.8] - Critical request chain with `rel=preload` -->
          <section>
            <h3>
                Critical request chain with<br>
                font preloading:
            </h3>
            <picture>
              <source srcset="/img/crp-preload-2x.webp 2x, /img/crp-preload-1x.webp 1x" type="image/webp">
              <source srcset="/img/crp-preload-2x.png 2x, /img/crp-preload-1x.png 1x" type="image/png">
              <img class="stretch" src="/img/crp-preload-1x.png" alt="An optimized critical request chain as audited by Lighthouse.">
            </picture>
          </section>
          <!-- [4.9] - Normal downloading of font assets (without `rel=preload`) -->
          <section>
            <h3>Normal font retrieval:</h3>
            <picture>
              <source srcset="/img/waterfall-no-preload.webp" type="image/webp">
              <img class="stretch" src="/img/waterfall-no-preload.png" alt="A resource waterfall graph of a page with fonts downloaded in their natural order.">
            </picture>
          </section>
          <!-- [4.10] - Font assets reprioritized (with `rel=preload`) -->
          <section>
            <h3>Reprioritizing with <code>rel=preload</code>:</h3>
            <picture>
              <source srcset="/img/waterfall-preload.webp" type="image/webp">
              <img class="stretch" src="/img/waterfall-preload.png" alt="A resource waterfall graph of a page with fonts effectively reprioritized using `rel=preload`.">
            </picture>
          </section>
          <!-- [4.11] - Timeline Comparison -->
          <section>
            <h3>Without <code>rel=preload</code> <span style="font-size: .625em;">⤵</span></h3>
            <div class="scroll-container">
              <picture class="scroll-container">
                <source srcset="/img/preload-swap-timeline.webp" type="image/webp">
                <img width="3310" height="472" src="/img/preload-swap-timeline.png" alt="A comparison of screenshot rolls of a page loading with fonts loading normally vs. loading via `rel=preload`.">
              </picture>
            </div>
            <h3>With <code>rel=preload</code> <span style="font-size: .625em;">⤴</span></h3>
          </section>
          <!-- [4.12] - A Few Friendly Reminders -->
          <section data-state="warning">
            <h2 class="accent">Friendly reminders:</h2>
            <ul>
              <li class="fragment">Omitting the <code>as</code> attribute causes resources to be downloaded twice. Supply a value of <code>font</code> for fonts.</li>
              <li class="fragment">Supply the resource's content type via the <code>type</code> attribute so browsers don't download resources they can't use.</li>
              <li class="fragment">You <u>must</u> specify a <code>crossorigin</code> attribute for font resources. <span class="fragment">(<a href="https://drafts.csswg.org/css-fonts/#font-fetching-requirements" rel="noopener">Yes, even for fonts on your own server</a>.)</span></li>
            </ul>
          </section>
          <!-- [4.13] - A few more things -->
          <section data-state="warning">
            <h2 class="accent">A few more things:</h2>
            <ul>
              <li class="fragment">Don't preload things you aren't going to use on the page! <span class="fragment">(Use <code>rel=prefetch</code> for that)</span></li>
              <li class="fragment">Don't preload everything and the kitchen sink!</li>
              <li class="fragment">If specifying <code>rel=preload</code> as an HTTP header, use the <code>nopush</code> flag to prevent server pushes you may not want. <span class="fragment">(<a href="https://jakearchibald.com/2017/h2-push-tougher-than-i-thought/" rel="noopener">Server push is kind of tough</a>.)</span></li>
            </ul>
          </section>
        </section>
        <!-- [5.0] - `Save-Data` -->
        <section>
          <!-- [5.1] - Skip "nice to have" fonts using `Save-Data` -->
          <section data-state="section-slide">
            <div class="unfocused-heading">
              <h4><code>rel=preload</code></h4>
              <h4 class="accent">for faster font loading</h4>
            </div>
            <div class="focused-heading">
              <h2><code>Save-Data</code> and</h2>
              <h2 class="accent">skip unnecessary fonts</h2>
            </div>
            <div class="unfocused-heading invisible">
              <h4>&nbsp;</h4>
              <h4 class="accent">&nbsp;</h4>
            </div>
          </section>
          <!-- [5.2] - What is `Save-Data`? -->
          <section>
            <blockquote cite="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints-05#section-3.4">
              &quot;The <code>Save-Data</code> request header field consists of one or more tokens that indicate client's preference for reduced data usage, due to high transfer costs, slow connection speeds, or other reasons.&quot;
              <cite>&mdash; <a href="https://tools.ietf.org/html/draft-ietf-httpbis-client-hints-05#section-3.4" rel="noopener">HTTP Client Hints Specification, &sect; 3.4</a></cite>
            </blockquote>
          </section>
          <!-- [5.3] - In other words -->
          <section class="statement-slide">
            <h2 class="accent">In other words,</h2>
            <h3><code>Save-Data</code> is a header sent by clients in a "data saver" mode. <span class="fragment">Applications can deliver less resources if it is present</code>.</h3>
          </section>
          <!-- [5.4] - How `Save-Data` works (Pt. I) -->
          <section>
            <h3>Toggle data saver:</h3>
            <picture>
              <source srcset="/img/data-saver-android-2x.webp 2x, /img/data-saver-android-1x.webp 1x" type="image/webp">
              <source srcset="/img/data-saver-android-2x.png 2x, /img/data-saver-android-1x.png 1x" type="image/png">
              <img src="/img/data-saver-android-1x.png" alt="A settings screen in Chrome where a user can toggle the data saver mode, along with a readout of bytes saved.">
            </picture>
          </section>
          <!-- [5.5] - How `Save-Data` works (Pt. II) -->
          <section>
            <h3>browser sends a <code>Save-Data</code> header with a value of <code>On</code> for every request:</h3>
            <picture>
              <source srcset="/img/save-data-header-2x.webp 2x, /img/save-data-header-1x.webp 1x" type="image/webp">
              <source srcset="/img/save-data-header-2x.png 2x, /img/save-data-header-1x.png 1x" type="image/png">
              <img class="stretch larger" src="/img/save-data-header-1x.png" alt="Request headers for an asset shown in Chrome dev tools, with the `Save-Data` header at the bottom of the list.">
            </picture>
          </section>
          <!-- [5.6] - `Save-Data` use cases -->
          <section>
            <h2><code>Save-Data</code> use cases:</h2>
            <ul>
              <li class="fragment">Serve low resolution imagery for high-res screens</li>
              <li class="fragment">Stream lower quality video</li>
              <li class="fragment">Opt out of server pushes</li>
              <li class="fragment">Opt out of non-essential media</li>
              <li class="fragment">Opt out of &quot;nice-to-have&quot; typefaces</li>
            </ul>
          </section>
          <!-- [5.7] - Detect `Save-Data` -->
          <section>
            <h2>Detect <code>Save-Data</code>:</h2>
            <pre><code class="php">&lt;?php
$saveData = false;

if(isset($_SERVER["HTTP_SAVE_DATA"]) && strtolower($_SERVER["HTTP_SAVE_DATA"]) === "on"){
  $saveData = true;
}
?&gt;</code></pre>
          </section>
          <!-- [5.8] - Conditionally serve `@font-faces` (Method 1) -->
          <section>
            <h2>Conditionally serve fonts:</h2>
            <pre><code class="html">&lt;!-- We needs it --&gt;
&lt;style&gt;
  @font-face{
    font-family: "Sooo Important Sans";
    src: local("Sooo Important Sans"),
         url("/fonts/sooo-important.woff2") format("woff2"),
         url("/fonts/sooo-important.woff") format("woff"),
         url("/fonts/sooo-important.ttf") format("truetype");
  }
&lt;/style&gt;

&lt;!-- Nice to have, but not a deal-breaker --&gt;
&lt;?php if($saveData === false){ ?&gt;
  &lt;style&gt;
    @font-face{
      font-family: "Whatever Sans";
      src: local("Whatever Sans"),
           url("/fonts/whatever.woff2") format("woff2"),
           url("/fonts/whatever.woff") format("woff"),
           url("/fonts/whatever.ttf") format("truetype");
    }
  &lt;/style&gt;
&lt;?php } ?&gt;</code></pre>
            <h3>(Method 1)</h3>
          </section>
          <!-- [5.9] - Conditionally serve `@font-faces` (Method 2) -->
          <section>
            <h2>Conditionally serve fonts:</h2>
            <!-- // TODO -->
            <h3>(Method 2)</h3>
          </section>
          <!-- [5.10] - `Save-Data` kicks in -->
          <section>
            <div>
              <h3>Without:</h3>
              <picture>
                <source srcset="/img/save-data-off-2x.webp 2x, /img/save-data-off-1x.webp 1x" type="image/webp">
                <source srcset="/img/save-data-off-2x.png 2x, /img/save-data-off-1x.png 1x" type="image/png">
                <img class="stretch larger" src="/img/save-data-off-1x.png" alt="A list of font resources in Chrome's network panel, showing all fonts downloaded when `Save-Data` is off.">
              </picture>
            </div>
            <div class="fragment">
              <h3>With:</h3>
              <picture>
                <source srcset="/img/save-data-on-2x.webp 2x, /img/save-data-on-1x.webp 1x" type="image/webp">
                <source srcset="/img/save-data-on-2x.png 2x, /img/save-data-on-1x.png 1x" type="image/png">
                <img class="stretch larger" src="/img/save-data-on-1x.png" alt="A list of font resources in Chrome's network panel, showing only a few fonts downloaded because `Save-Data` is on.">
              </picture>
            </div>
          </section>
          <!-- [5.11] - Typeface differences -->
          <section>
            <div class="flex-item-container">
              <div>
                <h3>Without:</h3>
                <picture>
                  <source srcset="/img/more-typefaces-2x.webp 2x, /img/more-typefaces-1x.webp 1x" type="image/webp">
                  <source srcset="/img/more-typefaces-2x.png 2x, /img/more-typefaces-1x.png 1x" type="image/png">
                  <img class="full" src="/img/more-typefaces-1x.png" alt="A page rendering with the body copy in a custom typeface.">
                </picture>
              </div>
              <div class="fragment">
                <h3>With:</h3>
                <picture>
                  <source srcset="/img/less-typefaces-2x.webp 2x, /img/less-typefaces-1x.webp 1x" type="image/webp">
                  <source srcset="/img/less-typefaces-2x.png 2x, /img/less-typefaces-1x.png 1x" type="image/png">
                  <img class="full" src="/img/less-typefaces-1x.png" alt="A page rendering with the body copy in a system typeface because `Save-Data` is on.">
                </picture>
              </div>
            </div>
          </section>
          <!-- [5.12] - Learn more about `Save-Data` on the web -->
          <section>
            <h2>
              Learn more about<br>
              <code>Save-Data</code> on the web:
            </h2>
            <picture>
              <source srcset="/img/css-tricks-save-data-2x.webp 2x, /img/css-tricks-save-data-1x.webp 1x" type="image/webp">
              <source srcset="/img/css-tricks-save-data-2x.png 2x, /img/css-tricks-save-data-1x.png 1x" type="image/png">
              <img src="/img/css-tricks-save-data-1x.png" alt="Screenshot of CSS-Tricks `Save-Data` article in the browser.">
            </picture>
            <h3><a href="https://css-tricks.com/help-users-save-data/" rel="noopener">css-tricks.com/help-users-save-data</a></h3>
          </section>
        </section>
        <!-- [6.0] - Closing -->
        <section>
          <!-- [6.1] - Wrap it up -->
          <section data-state="wrap-it-up centered">
            <video class="stretch" muted id="wrap-it-up">
              <source src="/video/wrap-it-up.webm" type="video/webm">
              <source src="/video/wrap-it-up.mp4" type="video/mp4">
              <source src="/video/wrap-it-up.ogv" type="video/ogg">
            </video>
          </section>
        </section>
      </div>
    </div>
    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>
    <script>
      Reveal.initialize({
        history: true,
        controls: false,
        transition: "none",
        progress: false,
        viewDistance: 2,
        help: false,
        dependencies: [{
            src: 'plugin/notes/notes.js',
            async: true
          },
          {
            src: 'plugin/highlight/highlight.js',
            async: true,
            callback: function(){
              hljs.initHighlightingOnLoad();
            }
          }
        ]});

        Reveal.addEventListener("slidechanged", function(e){
          Reveal.setState(Reveal.getState());
        });

        Reveal.addEventListener("raccoon", function(){
          document.getElementById("raccoon").play();
        });

        Reveal.addEventListener("font-style-matcher", function(){
          document.getElementById("font-style-matcher").play();
        });

        Reveal.addEventListener("foit-vs-fout", function(){
          document.getElementById("foit").play();
          document.getElementById("fout").play();
        });

        Reveal.addEventListener("wrap-it-up", function(){
          document.getElementById("wrap-it-up").play();
        });
    </script>
    <script src="/js/jquery.js"></script>
  </body>
</html>
